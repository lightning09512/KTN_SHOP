<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·ªè h√†ng - KTNShop</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div th:replace="fragments/layout :: header"></div>

    <div class="container-fluid" style="padding: 20px;">
        
        <!-- Th√¥ng b√°o -->
        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${successMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <div th:if="${infoMessage}" class="alert alert-info alert-dismissible fade show" role="alert">
            <span th:text="${infoMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <div class="row">
            <div class="col-lg-8">
                <h2>üõí Gi·ªè h√†ng c·ªßa b·∫°n</h2>

                <div th:if="${isEmpty}" class="alert alert-warning" style="margin: 30px 0; text-align: center; padding: 40px;">
                    <i class="fas fa-shopping-cart" style="font-size: 3rem; color: #ff9800;"></i>
                    <h5 class="mt-3">Gi·ªè h√†ng ch∆∞a c√≥ s·∫£n ph·∫©m</h5>
                    <p class="text-muted">H√£y ti·∫øp t·ª•c mua s·∫Øm ƒë·ªÉ th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng</p>
                    <a href="/" class="btn btn-primary mt-3">Ti·∫øp t·ª•c mua s·∫Øm</a>
                </div>

                <div th:unless="${isEmpty}" class="cart-items-list">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>S·∫£n ph·∫©m</th>
                                    <th>Gi√°</th>
                                    <th>S·ªë l∆∞·ª£ng</th>
                                    <th>Th√†nh ti·ªÅn</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="item : ${cart.cartItems}">
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <img th:src="${item.product.image}" alt="${item.product.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
                                            <div>
                                                <p style="margin: 0; font-weight: 500;" th:text="${item.product.name}"></p>
                                                <small style="color: #999;" th:text="${item.product.category.name}"></small>
                                            </div>
                                        </div>
                                    </td>
                                    <td th:text="'‚Ç´ ' + ${#numbers.formatDecimal(item.unitPrice, 0, 'COMMA')}"></td>
                                    <td>
                                        <form th:action="@{/cart/update}" method="post" style="display: inline;">
                                            <input type="hidden" name="cartItemId" th:value="${item.id}">
                                            <input type="number" name="quantity" th:value="${item.quantity}" min="1" max="100" style="width: 60px; padding: 5px;">
                                            <button type="submit" class="btn btn-sm btn-primary">‚Üª C·∫≠p nh·∫≠t</button>
                                        </form>
                                    </td>
                                    <td class="text-danger fw-bold" th:text="'‚Ç´ ' + ${#numbers.formatDecimal(item.unitPrice * item.quantity, 0, 'COMMA')}"></td>
                                    <td>
                                        <form th:action="@{/cart/remove}" method="post" style="display: inline;">
                                            <input type="hidden" name="cartItemId" th:value="${item.id}">
                                            <button type="submit" class="btn btn-sm btn-danger">
                                                <i class="fas fa-trash"></i> X√≥a
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card" style="padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4>T√≥m t·∫Øt ƒë∆°n h√†ng</h4>
                    <hr>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>T·∫°m t√≠nh:</span>
                        <strong th:text="'‚Ç´ ' + ${#numbers.formatDecimal(totalPrice, 0, 'COMMA')}"></strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>V·∫≠n chuy·ªÉn:</span>
                        <strong>Mi·ªÖn ph√≠</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px; padding-top: 10px; border-top: 1px solid #eee;">
                        <span style="font-size: 16px;">T·ªïng c·ªông:</span>
                        <strong style="font-size: 18px; color: #e74c3c;" th:text="'‚Ç´ ' + ${#numbers.formatDecimal(totalPrice, 0, 'COMMA')}"></strong>
                    </div>

                    <div style="display: grid; gap: 10px;">
                        <a th:unless="${isEmpty}" href="/orders/checkout" class="btn btn-danger" style="display: block; text-align: center;">
                            <i class="fas fa-credit-card"></i> Ti·∫øn h√†nh thanh to√°n
                        </a>
                        <a href="/" class="btn btn-outline-secondary" style="display: block; text-align: center;">
                            <i class="fas fa-arrow-left"></i> Ti·∫øp t·ª•c mua s·∫Øm
                        </a>
                        <form th:unless="${isEmpty}" th:action="@{/cart/clear}" method="post" style="display: block;">
                            <button type="submit" class="btn btn-outline-danger w-100">
                                <i class="fas fa-trash"></i> X√≥a to√†n b·ªô gi·ªè h√†ng
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:replace="fragments/layout :: footer"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="/js/script.js"></script>
</body>
</html>
